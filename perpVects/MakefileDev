#CC := clang++
CC := g++
FFLAGS ?=
TARGET ?= runTests

CPPFLAGS ?= -Wuninitialized -g #-fsanitize=thread

CPPFLAGS += $(FFLAGS)
CPPFLAGS += -std=c++14
CPPFLAGS += -Wno-shift-count-overflow
CPPFLAGS += -Wall
CPPFLAGS += -Wextra
CPPFLAGS += -Werror
CPPFLAGS += -MMD
CPPFLAGS += -lm
CPPFLAGS += -lpthread
CPPFLAGS += -pthread
CPPFLAGS += -I../gdb/inst
CPPFLAGS += -I.
CPPFLAGS += -isystem eigen
CPPFLAGS += -isystem eigen/Eigen

DEPFLAGS += -MD -MF $*.d

TESTS    := $(wildcard tests/*.cpp)
SOURCE   := $(wildcard *.cpp)
SOURCE   += $(TESTS)

OBJ      := $(SOURCE:.cpp=.o)
DEPS     := $(SOURCE:.cpp=.d)


.PHONY : all
all :  $(TARGET)

$(TARGET) : $(OBJ)
	$(CC) $(CPPFLAGS)   -o $@ $^

%.o : %.cpp
	$(CC) $(CPPFLAGS) $(DEPFLAGS) -c $< -o $@

.PRECIOUS: %.d
-include $(SOURCE:%.cpp=%.d)

.PHONY : clean
clean :
	rm -f $(OBJ)
	rm -f $(DEPS)

.PHONY: veryclean distclean
veryclean : distclean
distclean : clean
	rm -f $(TARGET)

