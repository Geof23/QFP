#This file, from a list of hosts, does the following through ssh commands:
## cd QFP && git pull
## cd QFP/perpVects && make -j [appropriate number] -f Makefile2
## cd QFP && git add -u && git commit -m 'auto commit, test results'
## genDiffTable

testname ?= general

.phony: all

KINGSPEAK := u0422778@kingspeak.chpc.utah.edu 12
M344 :=  sawaya@ms0236.utah.cloudlab.us 1
BIHEX := sawaya@bihexal.cs.utah.edu 24

HOSTS := KINGSPEAK BIHEX #M344

TARGETS := $(foreach h, $(HOSTS), $h_exec)

all: $(TARGETS)

define RULE
$1_exec :
	-ssh $2 'cd QFP && git pull && cd perpVects && make -j $3 -f Makefile2 && cd .. && git add -u && git commit -m "auto commit, test results" && git push'
endef

$(foreach h, $(HOSTS), $(eval $(call RULE, $(strip $h), $(word 1, $($(strip $h))), $(word 2, $($(strip $h))))))
